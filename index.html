
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Native DDNS Cloudflare agent for Synology DSM and SRM with support for multidomains and subdomains">
      
      
        <meta name="author" content="mrikirill">
      
      
        <link rel="canonical" href="https://github.com/mrikirill/KTSynologyDDNSCloudflareMultidomain/">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>KTSynologyDDNSCloudflareMultidomain Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#synology-dynamic-dns-native-agent-for-cloudflare-multidomains-subdomains" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="KTSynologyDDNSCloudflareMultidomain Documentation" class="md-header__button md-logo" aria-label="KTSynologyDDNSCloudflareMultidomain Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KTSynologyDDNSCloudflareMultidomain Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mrikirill/KTSynologyDDNSCloudflareMultidomain" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="KTSynologyDDNSCloudflareMultidomain Documentation" class="md-nav__button md-logo" aria-label="KTSynologyDDNSCloudflareMultidomain Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    KTSynologyDDNSCloudflareMultidomain Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mrikirill/KTSynologyDDNSCloudflareMultidomain" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Home
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-this-project" class="md-nav__link">
    <span class="md-ellipsis">
      Why this project?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stack" class="md-nav__link">
    <span class="md-ellipsis">
      Stack
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-this-native-agent-does" class="md-nav__link">
    <span class="md-ellipsis">
      What this native agent does
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#srm-support" class="md-nav__link">
    <span class="md-ellipsis">
      SRM Support
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-agent-locally" class="md-nav__link">
    <span class="md-ellipsis">
      Build the agent locally
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#before-you-start" class="md-nav__link">
    <span class="md-ellipsis">
      Before you start
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-install" class="md-nav__link">
    <span class="md-ellipsis">
      How to install
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-and-known-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting and known issues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting and known issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloudflare-api-free-domains-limitation" class="md-nav__link">
    <span class="md-ellipsis">
      CloudFlare API free domains limitation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-test-failed-or-error-returned" class="md-nav__link">
    <span class="md-ellipsis">
      Connection test failed or error returned
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudflare-no-longer-listed-as-a-ddns-provider-after-dsm-or-srm-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Cloudflare no longer listed as a DDNS provider after DSM or SRM updates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-cloudflare-ports" class="md-nav__link">
    <span class="md-ellipsis">
      Default Cloudflare ports
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debug" class="md-nav__link">
    <span class="md-ellipsis">
      Debug
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-messages" class="md-nav__link">
    <span class="md-ellipsis">
      Output messages
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#credits" class="md-nav__link">
    <span class="md-ellipsis">
      Credits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#support-this-project" class="md-nav__link">
    <span class="md-ellipsis">
      Support this project
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-this-project" class="md-nav__link">
    <span class="md-ellipsis">
      Why this project?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stack" class="md-nav__link">
    <span class="md-ellipsis">
      Stack
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-this-native-agent-does" class="md-nav__link">
    <span class="md-ellipsis">
      What this native agent does
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#srm-support" class="md-nav__link">
    <span class="md-ellipsis">
      SRM Support
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-agent-locally" class="md-nav__link">
    <span class="md-ellipsis">
      Build the agent locally
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#before-you-start" class="md-nav__link">
    <span class="md-ellipsis">
      Before you start
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-install" class="md-nav__link">
    <span class="md-ellipsis">
      How to install
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-and-known-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting and known issues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting and known issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloudflare-api-free-domains-limitation" class="md-nav__link">
    <span class="md-ellipsis">
      CloudFlare API free domains limitation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-test-failed-or-error-returned" class="md-nav__link">
    <span class="md-ellipsis">
      Connection test failed or error returned
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudflare-no-longer-listed-as-a-ddns-provider-after-dsm-or-srm-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Cloudflare no longer listed as a DDNS provider after DSM or SRM updates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-cloudflare-ports" class="md-nav__link">
    <span class="md-ellipsis">
      Default Cloudflare ports
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debug" class="md-nav__link">
    <span class="md-ellipsis">
      Debug
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-messages" class="md-nav__link">
    <span class="md-ellipsis">
      Output messages
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#credits" class="md-nav__link">
    <span class="md-ellipsis">
      Credits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#support-this-project" class="md-nav__link">
    <span class="md-ellipsis">
      Support this project
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<p><a href="https://github.com/mrikirill/KTSynologyDDNSCloudflareMultidomain/actions/workflows/test.yml"><img alt="Unit tests" src="https://github.com/mrikirill/KTSynologyDDNSCloudflareMultidomain/actions/workflows/test.yml/badge.svg" /></a></p>
<h1 id="synology-dynamic-dns-native-agent-for-cloudflare-multidomains-subdomains">Synology Dynamic DNS Native Agent for Cloudflare (Multidomains &amp; Subdomains)</h1>
<p>This project is based on my PHP version of the agent: https://github.com/mrikirill/SynologyDDNSCloudflareMultidomain</p>
<p>Documentation website: https://mrikirill.github.io/KTSynologyDDNSCloudflareMultidomain/</p>
<p><a href="https://github.com/sponsors/mrikirill"><img alt="Sponsor" src="https://img.shields.io/badge/sponsor-GitHub%20Sponsors-brightgreen" /></a></p>
<h2 id="why-this-project">Why this project?</h2>
<p>The idea of this project is to provide a native agent for <a href="https://www.synology.com/en-global/dsm">Synology DSM</a> and <a href="https://www.synology.com/en-global/srm">SRM</a> devices ⚠️(read <a href="#srm-support">here</a>) to update Cloudflare DNS records without requiring any dependencies.</p>
<p>This project is based on <a href="https://github.com/mrikirill/SynologyDDNSCloudflareMultidomain">the original PHP version of the agent</a> but is written in <a href="https://kotlinlang.orgnative-overview.html">Kotlin Native</a> and does not require the JVM. The agent is a standalone executable file that doesn't rely on system dependencies, which is the main difference from the PHP version. Additionally, it includes unit tests covering the main logic of the agent.</p>
<h2 id="stack">Stack</h2>
<ul>
<li><a href="https://kotlinlang.orgnative-overview.html">Kotlin Native</a> with target <a href="https://kotlinlang.orgnative-target-support.html#tier-2">linuxX64 and linuxArm64</a></li>
<li><a href="https://ktor.ioclient-engines.html#curl">Ktor Client Curl Engine</a></li>
</ul>
<h2 id="table-of-contents">Table of contents</h2>
<ul>
<li><a href="#what-this-native-agent-does">What this native agent does</a></li>
<li><a href="#srm-support">SRM Support</a></li>
<li><a href="#build-the-agent-locally">Build the agent locally</a></li>
<li><a href="#before-you-start">Before you start</a></li>
<li><a href="#how-to-install">How to install</a></li>
<li><a href="#troubleshooting-and-known-issues">Troubleshooting and known issues</a></li>
<li><a href="#cloudflare-api-free-domains-limitation">CloudFlare API free domains limitation</a></li>
<li><a href="#connection-test-failed-or-error-returned">Connection test failed or error returned</a></li>
<li><a href="#cloudflare-no-longer-listed-as-a-ddns-provider-after-dsm-or-srm-updates">Cloudflare no longer listed as a DDNS provider after a DSM update</a></li>
<li><a href="#default-cloudflare-ports">Default Cloudflare ports</a></li>
<li><a href="#debug">Debug script</a></li>
<li><a href="#output-messages">Output messages</a></li>
<li><a href="#credits">Credits</a></li>
<li><a href="#support-this-project">Support this project</a></li>
</ul>
<h2 id="what-this-native-agent-does">What this native agent does</h2>
<ul>
<li>Works as a standalone executable file.</li>
<li>Functionality remains consistent with the <a href="https://github.com/mrikirill/SynologyDDNSCloudflareMultidomain">PHP version of the agent</a>.</li>
<li>Designed for Synology DSM and ⚠️<a href="#srm-support">Synology SRM devices</a> to integrate Cloudflare support into <code>Network Centre &gt; Dynamic DNS (DDNS)</code>.</li>
<li>Supports single domains, multidomains, subdomains, regional domains, or any combination etc (e.g., dev.my.domain.com.au, domain.com.uk, etc.).</li>
<li>Simple installation process.</li>
<li>Based on <a href="https://developers.cloudflare.com/api">CloudFlare API v4</a></li>
<li>Use <a href="https://www.ipify.org">ipify.org</a> to detect IPv6</li>
<li>Compatible with both IPv4 and IPv6 dual stack.</li>
</ul>
<h2 id="srm-support">SRM Support</h2>
<p><a href="#https://www.synology.com/en-global/products/routers">SRM-based devices</a> use the Linux Arm64 architecture. The agent has a build target for Linux Arm64 and should work on SRM devices. However, it needs to be built locally and tested on SRM devices. Currently, it has not been tested on SRM devices, and there is no established build process for Linux Arm64.</p>
<h2 id="build-the-agent-locally">Build the agent locally</h2>
<ol>
<li>
<p>Kotlin Native Documentation <a href="https://kotlinlang.orgnative-get-started.html">here</a></p>
</li>
<li>
<p>Clone the repository</p>
</li>
<li>
<p>Run the following command to build the agent</p>
</li>
</ol>
<pre><code>./gradlew build
</code></pre>
<p>Note: cause the agent includes the Ktor Client Curl Engine it requires extra steps documented <a href="https://ktor.ioclient-engines.html#curl">here</a></p>
<h2 id="before-you-start">Before you start</h2>
<p>Before starting the installation process, make sure you have (and know) the following information, or have completed these steps:</p>
<ol>
<li><em>Cloudflare credentials:</em></li>
</ol>
<p>a. Know your Cloudflare account username (or <a href="https://dash.cloudflare.com/sign-up">register for an account if you're new to Cloudflare</a>); and</p>
<p>b. Have your <a href="https://dash.cloudflare.com/profile/api-tokens">API key</a> - no need to use your Global API key! (More info: <a href="https://support.cloudflare.com/hc/en-us/articles/200167836-Managing-API-Tokens-and-Keys">API keys</a>).</p>
<p><img alt="image" src="example4.png" /></p>
<pre><code> c. Create a API key with following (3) permissions:

 **Zone** &gt; **Zone.Settings** &gt; **Read**  
 **Zone** &gt; **Zone** &gt; **Read**  
 **Zone** &gt; **DNS** &gt; **Edit**

 The affected zone ressouces have to be (at least):

**Include** &gt; **All zones from an account** &gt; `&lt;domain&gt;`
</code></pre>
<ol>
<li><em>DNS settings:</em></li>
</ol>
<p>Ensure the DNS A record(s) for the domain/zone(s) you wish to update with this script have been created (More information: <a href="https://support.cloudflare.com/hc/en-us/articles/360019093151-Managing-DNS-records-in-Cloudflare">Managing DNS records</a>).</p>
<p>Your DNS records should appear (or already be setup as follows) in Cloudflare:</p>
<p>(Note: Having Proxied turned on for your A records isn't necessary, but it will prevent those snooping around from easily finding out your current IP address)</p>
<p><img alt="image" src="example1.png" /></p>
<ol>
<li><em>SSH access to your Synology device:</em></li>
</ol>
<p>If you haven't setup this access, see the following Synology Knowledge Base article:
[How can I sign in to DSM/SRM with root privilege via SSH?[(https://kb.synology.com/en-id/DSM/tutorial/How_to_login_to_DSM_with_root_permission_via_SSH_Telnet)</p>
<h2 id="how-to-install">How to install</h2>
<ol>
<li><strong>SSH with sudo on your supported device:</strong></li>
</ol>
<p>a. For DSM Users:</p>
<p>Navigate to <strong>Control Panel &gt; Terminal &amp; SNMP &gt; Enable SSH service</strong></p>
<p>b. For SRM users:</p>
<p>Navigate to <strong>Control Panel &gt; Services &gt; System Services &gt; Terminal &gt; Enable SSH service</strong></p>
<p><img alt="image" src="example2.png" /></p>
<ol>
<li><strong>Connect via SSH:</strong> Connect to your supported device via SSH and run this command:</li>
</ol>
<p><code>wget https://raw.githubusercontent.com/mrikirill/KTSynologyDDNSCloudflareMultidomain/master/install.sh -O install.sh &amp;&amp; sudo bash install.sh</code></p>
<ol>
<li><strong>Update your DDNS settings:</strong></li>
</ol>
<p>a. <em>For DSM Users:</em> Navigate to <strong>Control Panel &gt; External Access &gt; DDNS</strong> then add new DDNS</p>
<p>b. <em>For SRM users:</em> Navigate to <strong>Network Centre &gt; Internet &gt; QuickConnect &amp; DDNS &gt; DDNS</strong> and press the Add button:</p>
<p>Add/Update the DDNS settings screen as follows:</p>
<ul>
<li>Service provider: Select Cloudflare</li>
<li>Hostname: this field is not used anymore, you can put any value here</li>
<li>
<p>Username:
     For a single domain: <strong>mydomain.com</strong>
     For multiple domains: <strong>subdomain.mydomain.com|vpn.mydomain.com</strong>
     (ensure each domain is separated: <code>|</code>)</p>
<p><strong>Note: there is 256 symbols limit on Hostname input</strong>
   * Password: Your created Cloudflare API Key</p>
</li>
</ul>
<p><img alt="image" src="example3.png" /></p>
<p>Finally, press the test connection button to confirm all information is correctly entered, before pressing Ok to save and confirm your details.</p>
<ol>
<li>Enjoy 🍺 and <strong>don't forget to deactivate SSH (step 1) if you don't need it</strong>.</li>
</ol>
<h2 id="troubleshooting-and-known-issues">Troubleshooting and known issues</h2>
<h3 id="cloudflare-api-free-domains-limitation">CloudFlare API free domains limitation</h3>
<p>CloudFlare API doesn't support domains with a .cf, .ga, .gq, .ml, or .tk TLD (top-level domain)</p>
<p>For more details read here: https://github.com/mrikirill/SynologyDDNSCloudflareMultidomain/issues/28 and https://community.cloudflare.com/t/unable-to-update-ddns-using-api-for-some-tlds/167228/61</p>
<p>Response example:</p>
<pre><code>{
  &quot;result&quot;: null,
  &quot;success&quot;: false,
  &quot;errors&quot;: [
    {
      &quot;code&quot;: 1038,
      &quot;message&quot;: &quot;You cannot use this API for domains with a .cf, .ga, .gq, .ml, or .tk TLD (top-level domain). To configure the DNS settings for this domain, use the Cloudflare Dashboard.&quot;
    }
  ],
  &quot;messages&quot;: []
}
</code></pre>
<h3 id="connection-test-failed-or-error-returned">Connection test failed or error returned</h3>
<p>This will manifest as either 1020 error; or the update attempt not showing in your Cloudflare Audit logs.</p>
<p>That generally means you may not have entered something correctly in the DDNS screen for your domain(s).</p>
<p>Revisit <a href="#before-you-begin">Before you begin</a> to ensure you have all the right information, then go back to Step 4 in <a href="#how-to-install">How to install</a> to make sure everything is correctly entered.</p>
<p><strong>Handy hint:</strong> You can also check your Cloudflare Audit logs to see what - if anything - has made it there with your API key (More information: <a href="https://support.cloudflare.com/hc/en-us/articles/115002833612-Understanding-Cloudflare-Audit-Logs">Understanding Cloudflare Audit Logs</a>). Updates using the API will appear in the Audit logs as a Rec Set action.</p>
<h3 id="cloudflare-no-longer-listed-as-a-ddns-provider-after-dsm-or-srm-updates">Cloudflare no longer listed as a DDNS provider after DSM or SRM updates</h3>
<p>If this occurs, simply <a href="#how-to-install">repeat the How to install steps</a> shown above.</p>
<h2 id="default-cloudflare-ports">Default Cloudflare ports</h2>
<p>Source <a href="https://support.cloudflare.com/hc/en-us/articles/200169156-Identifying-network-ports-compatible-with-Cloudflare-s-proxy">Identifying network ports compatible with Cloudflare's proxy</a></p>
<table>
<thead>
<tr>
<th>HTTP ports supported by Cloudflare</th>
<th>HTTPS ports supported by Cloudflare</th>
</tr>
</thead>
<tbody>
<tr>
<td>80</td>
<td>443</td>
</tr>
<tr>
<td>8080</td>
<td>2053</td>
</tr>
<tr>
<td>8880</td>
<td>2083</td>
</tr>
<tr>
<td>2052</td>
<td>2087</td>
</tr>
<tr>
<td>2082</td>
<td>2096</td>
</tr>
<tr>
<td>2086</td>
<td>8443</td>
</tr>
<tr>
<td>2095</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="debug">Debug</h2>
<p>You can run this script directly to see output logs</p>
<ul>
<li>
<p>SSH into your Synology system</p>
</li>
<li>
<p>Run this command:</p>
</li>
</ul>
<pre><code>./KTSynologyDDNSCloudflareMultidomain.kexe &quot;domain1.com|vpn.domain2.com&quot; &quot;your-Cloudflare-token&quot; &quot;any&quot; &quot;1.2.3.4 - ipv4 address&quot;
</code></pre>
<ul>
<li>Check output logs</li>
</ul>
<h2 id="output-messages">Output messages</h2>
<p>From <code>/etc.defaults/ddns_provider.conf</code>:</p>
<blockquote>
<p>When you write your own module, you can use the following words to tell user what happen by print it.
You can use your own message, but there is no multiple-language support.</p>
<p><code>good</code> -  Update successfully.</p>
<p><code>nochg</code> - Update successfully but the IP address have not changed.</p>
<p><code>nohost</code> - The hostname specified does not exist in this user account.</p>
<p><code>abuse</code> - The hostname specified is blocked for update abuse.</p>
<p><code>notfqdn</code> - The hostname specified is not a fully-qualified domain name.</p>
<p><code>badauth</code> - Authenticate failed.</p>
<p><code>911</code> - There is a problem or scheduled maintenance on provider side</p>
<p><code>badagent</code> - The user agent sent bad request(like HTTP method/parameters is not permitted)</p>
<p><code>badresolv</code> - Failed to connect to  because failed to resolve provider address.</p>
<p><code>badconn</code> - Failed to connect to provider because connection timeout.</p>
</blockquote>
<h2 id="credits">Credits</h2>
<p><a href="https://www.mkdocs.org">MKDoc - generate documentation</a></p>
<h2 id="support-this-project">Support this project</h2>
<p>If you find this project helpful, please support it here <a href="https://github.com/sponsors/mrikirill"><img alt="Sponsor" src="https://img.shields.io/badge/sponsor-GitHub%20Sponsors-brightgreen" /></a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>