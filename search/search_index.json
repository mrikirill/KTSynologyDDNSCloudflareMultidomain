{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#synology-dynamic-dns-native-agent-for-cloudflare-multidomains-subdomains","title":"Synology Dynamic DNS Native Agent for Cloudflare (Multidomains &amp; Subdomains)","text":"<p>This project is based on my PHP version of the agent: https://github.com/mrikirill/SynologyDDNSCloudflareMultidomain</p> <p>Documentation website: https://mrikirill.github.io/KTSynologyDDNSCloudflareMultidomain/</p> <p></p>"},{"location":"#why-this-project","title":"Why this project?","text":"<p>The idea of this project is to provide a native agent for Synology DSM and SRM devices \u26a0\ufe0f(read here) to update Cloudflare DNS records without requiring any dependencies.</p> <p>This project is based on the original PHP version of the agent but is written in Kotlin Native and does not require the JVM. The agent is a standalone executable file that doesn't rely on system dependencies, which is the main difference from the PHP version. Additionally, it includes unit tests covering the main logic of the agent.</p>"},{"location":"#stack","title":"Stack","text":"<ul> <li>Kotlin Native with target linuxX64 and linuxArm64</li> <li>Ktor Client Curl Engine</li> </ul>"},{"location":"#table-of-contents","title":"Table of contents","text":"<ul> <li>What this native agent does</li> <li>SRM Support</li> <li>Build the agent locally</li> <li>Before you start</li> <li>How to install</li> <li>Troubleshooting and known issues</li> <li>CloudFlare API free domains limitation</li> <li>Connection test failed or error returned</li> <li>Cloudflare no longer listed as a DDNS provider after a DSM update</li> <li>Default Cloudflare ports</li> <li>Debug script</li> <li>Output messages</li> <li>Credits</li> <li>Support this project</li> </ul>"},{"location":"#what-this-native-agent-does","title":"What this native agent does","text":"<ul> <li>Works as a standalone executable file.</li> <li>Functionality remains consistent with the PHP version of the agent.</li> <li>Designed for Synology DSM and \u26a0\ufe0fSynology SRM devices to integrate Cloudflare support into <code>Network Centre &gt; Dynamic DNS (DDNS)</code>.</li> <li>Supports single domains, multidomains, subdomains, regional domains, or any combination etc (e.g., dev.my.domain.com.au, domain.com.uk, etc.).</li> <li>Simple installation process.</li> <li>Based on CloudFlare API v4</li> <li>Use ipify.org to detect IPv6</li> <li>Compatible with both IPv4 and IPv6 dual stack.</li> </ul>"},{"location":"#srm-support","title":"SRM Support","text":"<p>SRM-based devices use the Linux Arm64 architecture. The agent has a build target for Linux Arm64 and should work on SRM devices. However, it needs to be built locally and tested on SRM devices. Currently, it has not been tested on SRM devices, and there is no established build process for Linux Arm64.</p>"},{"location":"#build-the-agent-locally","title":"Build the agent locally","text":"<ol> <li> <p>Kotlin Native Documentation here</p> </li> <li> <p>Clone the repository</p> </li> <li> <p>Run the following command to build the agent</p> </li> </ol> <pre><code>./gradlew build\n</code></pre> <p>Note: cause the agent includes the Ktor Client Curl Engine it requires extra steps documented here</p>"},{"location":"#before-you-start","title":"Before you start","text":"<p>Before starting the installation process, make sure you have (and know) the following information, or have completed these steps:</p> <ol> <li>Cloudflare credentials:</li> </ol> <p>a. Know your Cloudflare account username (or register for an account if you're new to Cloudflare); and</p> <p>b. Have your API key - no need to use your Global API key! (More info: API keys).</p> <p></p> <pre><code> c. Create a API key with following (3) permissions:\n\n **Zone** &gt; **Zone.Settings** &gt; **Read**  \n **Zone** &gt; **Zone** &gt; **Read**  \n **Zone** &gt; **DNS** &gt; **Edit**\n\n The affected zone ressouces have to be (at least):\n\n**Include** &gt; **All zones from an account** &gt; `&lt;domain&gt;`\n</code></pre> <ol> <li>DNS settings:</li> </ol> <p>Ensure the DNS A record(s) for the domain/zone(s) you wish to update with this script have been created (More information: Managing DNS records).</p> <p>Your DNS records should appear (or already be setup as follows) in Cloudflare:</p> <p>(Note: Having Proxied turned on for your A records isn't necessary, but it will prevent those snooping around from easily finding out your current IP address)</p> <p></p> <ol> <li>SSH access to your Synology device:</li> </ol> <p>If you haven't setup this access, see the following Synology Knowledge Base article: [How can I sign in to DSM/SRM with root privilege via SSH?[(https://kb.synology.com/en-id/DSM/tutorial/How_to_login_to_DSM_with_root_permission_via_SSH_Telnet)</p>"},{"location":"#how-to-install","title":"How to install","text":"<ol> <li>SSH with sudo on your supported device:</li> </ol> <p>a. For DSM Users:</p> <p>Navigate to Control Panel &gt; Terminal &amp; SNMP &gt; Enable SSH service</p> <p>b. For SRM users:</p> <p>Navigate to Control Panel &gt; Services &gt; System Services &gt; Terminal &gt; Enable SSH service</p> <p></p> <ol> <li>Connect via SSH: Connect to your supported device via SSH and run this command:</li> </ol> <p><code>wget https://raw.githubusercontent.com/mrikirill/KTSynologyDDNSCloudflareMultidomain/master/install.sh -O install.sh &amp;&amp; sudo bash install.sh</code></p> <ol> <li>Update your DDNS settings:</li> </ol> <p>a. For DSM Users: Navigate to Control Panel &gt; External Access &gt; DDNS then add new DDNS</p> <p>b. For SRM users: Navigate to Network Centre &gt; Internet &gt; QuickConnect &amp; DDNS &gt; DDNS and press the Add button:</p> <p>Add/Update the DDNS settings screen as follows:</p> <ul> <li>Service provider: Select Cloudflare</li> <li>Hostname: this field is not used anymore, you can put any value here</li> <li> <p>Username:      For a single domain: mydomain.com      For multiple domains: subdomain.mydomain.com|vpn.mydomain.com      (ensure each domain is separated: <code>|</code>)</p> <p>Note: there is 256 symbols limit on Hostname input    * Password: Your created Cloudflare API Key</p> </li> </ul> <p></p> <p>Finally, press the test connection button to confirm all information is correctly entered, before pressing Ok to save and confirm your details.</p> <ol> <li>Enjoy \ud83c\udf7a and don't forget to deactivate SSH (step 1) if you don't need it.</li> </ol>"},{"location":"#troubleshooting-and-known-issues","title":"Troubleshooting and known issues","text":""},{"location":"#cloudflare-api-free-domains-limitation","title":"CloudFlare API free domains limitation","text":"<p>CloudFlare API doesn't support domains with a .cf, .ga, .gq, .ml, or .tk TLD (top-level domain)</p> <p>For more details read here: https://github.com/mrikirill/SynologyDDNSCloudflareMultidomain/issues/28 and https://community.cloudflare.com/t/unable-to-update-ddns-using-api-for-some-tlds/167228/61</p> <p>Response example:</p> <pre><code>{\n  \"result\": null,\n  \"success\": false,\n  \"errors\": [\n    {\n      \"code\": 1038,\n      \"message\": \"You cannot use this API for domains with a .cf, .ga, .gq, .ml, or .tk TLD (top-level domain). To configure the DNS settings for this domain, use the Cloudflare Dashboard.\"\n    }\n  ],\n  \"messages\": []\n}\n</code></pre>"},{"location":"#connection-test-failed-or-error-returned","title":"Connection test failed or error returned","text":"<p>This will manifest as either 1020 error; or the update attempt not showing in your Cloudflare Audit logs.</p> <p>That generally means you may not have entered something correctly in the DDNS screen for your domain(s).</p> <p>Revisit Before you begin to ensure you have all the right information, then go back to Step 4 in How to install to make sure everything is correctly entered.</p> <p>Handy hint: You can also check your Cloudflare Audit logs to see what - if anything - has made it there with your API key (More information: Understanding Cloudflare Audit Logs). Updates using the API will appear in the Audit logs as a Rec Set action.</p>"},{"location":"#cloudflare-no-longer-listed-as-a-ddns-provider-after-dsm-or-srm-updates","title":"Cloudflare no longer listed as a DDNS provider after DSM or SRM updates","text":"<p>If this occurs, simply repeat the How to install steps shown above.</p>"},{"location":"#default-cloudflare-ports","title":"Default Cloudflare ports","text":"<p>Source Identifying network ports compatible with Cloudflare's proxy</p> HTTP ports supported by Cloudflare HTTPS ports supported by Cloudflare 80 443 8080 2053 8880 2083 2052 2087 2082 2096 2086 8443 2095"},{"location":"#debug","title":"Debug","text":"<p>You can run this script directly to see output logs</p> <ul> <li> <p>SSH into your Synology system</p> </li> <li> <p>Run this command:</p> </li> </ul> <pre><code>./KTSynologyDDNSCloudflareMultidomain.kexe \"domain1.com|vpn.domain2.com\" \"your-Cloudflare-token\" \"any\" \"1.2.3.4 - ipv4 address\"\n</code></pre> <ul> <li>Check output logs</li> </ul>"},{"location":"#output-messages","title":"Output messages","text":"<p>From <code>/etc.defaults/ddns_provider.conf</code>:</p> <p>When you write your own module, you can use the following words to tell user what happen by print it. You can use your own message, but there is no multiple-language support.</p> <p><code>good</code> -  Update successfully.</p> <p><code>nochg</code> - Update successfully but the IP address have not changed.</p> <p><code>nohost</code> - The hostname specified does not exist in this user account.</p> <p><code>abuse</code> - The hostname specified is blocked for update abuse.</p> <p><code>notfqdn</code> - The hostname specified is not a fully-qualified domain name.</p> <p><code>badauth</code> - Authenticate failed.</p> <p><code>911</code> - There is a problem or scheduled maintenance on provider side</p> <p><code>badagent</code> - The user agent sent bad request(like HTTP method/parameters is not permitted)</p> <p><code>badresolv</code> - Failed to connect to  because failed to resolve provider address.</p> <p><code>badconn</code> - Failed to connect to provider because connection timeout.</p>"},{"location":"#credits","title":"Credits","text":"<p>MKDoc - generate documentation</p>"},{"location":"#support-this-project","title":"Support this project","text":"<p>If you find this project helpful, please support it here </p>"}]}